!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory:factory(jQuery)}((function($){"use strict";var supportsCssTransitions="transition"in document.documentElement.style||"WebkitTransition"in document.documentElement.style,TouchFlow=function(el,settings){var defaults={useMouse:!0,useWheel:!0,axis:"x",page:0,speed:200,side:.15,snap:!1,scrollbar:!1,scrollbarAutoHide:!0,initComplete:null,stopped:null,resizeend:null};this.opts=$.extend({},defaults,settings),this.target=el,this.wrap=$(el),this.list=this.wrap.children(),this.wrapw=null,this.wraph=null,this.listw=null,this.listh=null,this.tmp=null,this.ticker=null,this.duration=this.opts.speed,this.side=this.opts.side,this.delay=17,this.posx=0,this.posy=0,this.startx=0,this.starty=0,this.speedx=0,this.speedy=0,this.prevx=0,this.prevy=0,this.tempx=0,this.tempy=0,this.right=0,this.bottom=0,this.state=!1,this.link=!0,this.lastmove=null,this.scroll={},this.init()};TouchFlow.prototype={init:function(){var _this=this;return this.list=this.wrap.children(),this.state=!1,"string"==typeof this.opts.page&&(this.opts.page=$(this.target).find(this.opts.page).eq(0).index()),this.set_limit(),this.go_page(this.opts.page),this.list.off("touchstart",this,this.touchstart).off("touchmove",this,this.touchmove).off("touchend touchcancel",this.touchend).off("transitionend",this,this.transitionend).off("wheel",this,this.wheel).off("dragstart").on("dragstart",(function(e){e.preventDefault()})).on("touchstart",this,this.touchstart).on("touchmove",this,this.touchmove).on("touchend touchcancel",this,this.touchend).on("transitionend",this,this.transitionend).on("wheel",this,this.wheel),this.opts.useMouse&&this.list.off("mousedown",this,this.touchstart).on("mousedown",this,this.touchstart),$(window).off("resize",this,this.resize).on("resize",this,this.resize),this.target.removeEventListener("click",this._containerClickHandler||function(){},!0),this._containerClickHandler=function(e){_this.link||(e.stopPropagation(),e.preventDefault())},this.target.addEventListener("click",this._containerClickHandler,!0),this.opts.scrollbar&&this.scrollbar_init(),"function"==typeof this.opts.initComplete&&this.opts.initComplete.call(this,this.get_event_data()),this},scrollbar_init:function(){void 0===this.scroll.wrap&&(this.scroll.wrap=$('<div class="touchflow-scrollbar"><div></div></div>'),this.scroll.bar=this.scroll.wrap.find(" > div"),this.wrap.append(this.scroll.wrap),this.scrollbar_pos())},scrollbar_pos:function(f){if(this.opts.scrollbar){var wrap=this.scroll.wrap,bar=this.scroll.bar,full,pos,transition=f?"300ms":"0ms";"x"===this.opts.axis?(full=this.wrapw/this.listw*100,pos=-this.posX()/this.listw*100,wrap.css({width:"100%",height:"5px",opacity:1}),bar.css({width:full+"%",height:"5px",left:pos+"%",transition:transition})):"y"===this.opts.axis&&(full=this.wraph/this.listh*100,pos=-this.posY()/this.listh*100,wrap.css({width:"5px",height:"100%",opacity:1}),bar.css({width:"5px",height:full+"%",top:pos+"%",transition:transition})),this.opts.scrollbarAutoHide&&setTimeout((function(){f&&wrap.css({opacity:0})}),300)}},touchstart:function(e){var obj=e.data,pos=$(this).position();obj.startx=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,obj.starty=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY,obj.posx=obj.startx-pos.left,obj.posy=obj.starty-pos.top,"function"==typeof obj.opts.stopped&&0!==obj.speedx&&obj.opts.stopped.call(obj,obj.get_event_data()),obj.speedx=0,obj.speedy=0,obj.prevx=0,obj.prevy=0,obj.tempx=0,obj.tempy=0,obj.stop_animation(),obj.start_animation(),obj.state=!0,obj.lastmove=e,e.stopPropagation(),"mousedown"==e.type&&$(document).on("mousemove",obj,obj.touchmove).on("mouseup",obj,obj.touchend)},touchmove:function(e){var obj=e.data,pageX=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,pageY=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY,left=pageX-obj.startx,top=pageY-obj.starty,w=left<0?-1*left:left,h=top<0?-1*top:top,thisx=pageX-obj.posx,thisy=pageY-obj.posy,limitx,limity,gapx=thisx-obj.get_limit({x:thisx}),gapy=thisy-obj.get_limit({y:thisy});"x"==obj.opts.axis&&w>h?(obj.link=!1,e.preventDefault(),Math.abs(gapx)>0&&(thisx-=gapx/2),obj.set_pos({x:thisx})):"y"==obj.opts.axis&&w<h&&(obj.link=!1,e.preventDefault(),Math.abs(gapy)>0&&(thisy-=gapy/2),obj.set_pos({y:thisy})),obj.lastmove=e,e.stopPropagation()},touchend:function(e){var obj=e.data,pageX=obj.lastmove.originalEvent.touches?obj.lastmove.originalEvent.touches[0].pageX:obj.lastmove.pageX,pageY=obj.lastmove.originalEvent.touches?obj.lastmove.originalEvent.touches[0].pageY:obj.lastmove.pageY,left=pageX-obj.startx,top=pageY-obj.starty,pos=$(obj.list).position(),thisx=pos.left,thisy=pos.top,to=0;obj.state=!1,obj.speedx=obj.tempx,obj.speedy=obj.tempy,"x"!=obj.opts.axis||obj.limit_chk({x:thisx})?"y"!=obj.opts.axis||obj.limit_chk({y:thisy})?"function"==typeof obj.opts.stopped&&obj.opts.stopped.call(obj,obj.get_event_data()):(to=top<0?obj.bottom:0,obj.stop_animation(),obj.set_pos({y:to},obj.duration)):(to=left<0?obj.right:0,obj.stop_animation(),obj.set_pos({x:to},obj.duration)),setTimeout((function(){obj.link=!0}),50),e.stopPropagation(),obj.opts.useMouse&&$(document).off("mousemove",obj.touchmove).off("mouseup",obj.touchend)},transitionend:function(e){var obj=e.data;"function"==typeof obj.opts.stopped&&obj.opts.stopped.call(obj,obj.get_event_data()),obj.scrollbar_pos(!0)},resize:function(e){var obj=e.data;clearTimeout(obj.tmp),obj.tmp=setTimeout((function(){obj.set_limit(),obj.pos_control(),"function"==typeof obj.opts.resizeend&&obj.opts.resizeend.call(obj,obj.get_event_data()),obj.scrollbar_pos(!0)}),200)},wheel:function(e){var obj=e.data,pos=0,chk={},gap=100;if(!1===obj.opts.useWheel)return!0;if(e.originalEvent.deltaY>0)"x"===obj.opts.axis?(chk={x:(pos=obj.posX())-1},obj.posX(pos-100)):(chk={y:(pos=obj.posY())-1},obj.posY(pos-100));else{if(!(e.originalEvent.deltaY<0))return!0;"x"===obj.opts.axis?(chk={x:(pos=obj.posX())+1},obj.posX(pos+100)):(chk={y:(pos=obj.posY())+1},obj.posY(pos+100))}!0===obj.limit_chk(chk)&&e.preventDefault(),obj.scrollbar_pos(!0)},get_nearby_page:function(n){var pos="number"==typeof n?Math.abs(n):null,arr=[],list_pos=this.list.offset(),li=this.list.children(),len=li.length,tg="";"x"===this.opts.axis?(tg="left",null===pos&&(pos=Math.abs(list_pos.left))):(tg="top",null===pos&&(pos=Math.abs(list_pos.top)));for(var i=0;i<len;++i)arr[i]=Math.abs(li.eq(i).offset()[tg]-list_pos[tg]-pos);return arr.indexOf(Math.min.apply(null,arr))},start_animation:function(){window.requestAnimationFrame?this.ticker=requestAnimationFrame(this.move.bind(this)):this.ticker=setTimeout(this.move.bind(this),this.delay)},stop_animation:function(){window.requestAnimationFrame?cancelAnimationFrame(this.ticker):clearTimeout(this.ticker)},move:function(){var pos=this.list.position(),thisx=pos.left,thisy=pos.top;if(!1===this.state){var abs_spdx=Math.abs(this.speedx),abs_spdy=Math.abs(this.speedy);if(this.opts.snap&&"x"===this.opts.axis&&abs_spdx<10)return this.stop_animation(),void this.go_page(this.get_nearby_page(thisx));if(this.opts.snap&&"y"===this.opts.axis&&abs_spdy<10)return this.stop_animation(),void this.go_page(this.get_nearby_page(thisy));if(abs_spdx<1&&abs_spdy<1)return this.stop_animation(),"function"==typeof this.opts.stopped&&0!==this.speedx&&this.opts.stopped.call(this,this.get_event_data()),void this.scrollbar_pos(!0);this.speedx=.95*this.speedx,this.speedy=.95*this.speedy,thisx+=this.speedx,thisy+=this.speedy;var x_chk=this.limit_chk({x:thisx}),x_limit=this.get_limit({x:thisx}),y_chk=this.limit_chk({y:thisy}),y_limit=this.get_limit({y:thisy});if(x_chk&&y_chk)this.set_pos({x:x_limit,y:y_limit});else{if(this.set_pos({x:thisx,y:thisy}),Math.abs(thisx-x_limit)>70)return this.stop_animation(),void this.set_pos({x:x_limit},this.duration);if(Math.abs(thisy-y_limit)>70)return this.stop_animation(),void this.set_pos({y:y_limit},this.duration)}}else this.tempx=thisx-this.prevx,this.tempy=thisy-this.prevy,this.prevx=thisx,this.prevy=thisy;this.scrollbar_pos(),this.start_animation()},limit_chk:function(obj){return void 0!==obj.x?obj.x>0==!1&&obj.x<this.right==!1:void 0!==obj.y?obj.y>0==!1&&obj.y<this.bottom==!1:void 0},set_limit:function(){var listw=0,listh=0;this.wrapw=this.wrap.width(),this.wraph=this.wrap.height(),$(this.list.children()).each((function(){listw+=$(this).outerWidth(),listh+=$(this).outerHeight()})),this.listw=listw,this.listh=listh,this.wrapw<this.listw?this.right=-(this.listw-this.wrapw):this.right=0,this.wraph<this.listh?this.bottom=-(this.listh-this.wraph):this.bottom=0},get_limit:function(obj){return void 0!==obj.x?(obj.x>0&&(obj.x=0),obj.x<this.right&&(obj.x=this.right),obj.x):void 0!==obj.y?(obj.y>0&&(obj.y=0),obj.y<this.bottom&&(obj.y=this.bottom),obj.y):void 0},go_page:function(page){var list_pos=this.list.offset(),pos=this.list.children().map((function(){return $(this).offset()}));if(this.opts.page=page,"x"==this.opts.axis){var x=-(pos[page].left-list_pos.left-(pos[0].left-list_pos.left));this.posX(x)}else if("y"==this.opts.axis){var y=-(pos[page].top-list_pos.top-(pos[0].top-list_pos.top));this.posY(y)}return this},view_page:function(page){this.opts.page=page;var tg=this.list.children().eq(page);if("x"==this.opts.axis){var x=tg.position().left,w=tg.width(),xside=this.wrapw*this.side,posX=this.posX();x+posX<0&&(x=-(x-xside),this.posX(x)),x+w+posX>this.wrapw&&(x=-(x+w-this.wrapw+xside),this.posX(x))}else if("y"==this.opts.axis){var y=tg.position().top,h=tg.height(),yside=this.wraph*this.side,posY=this.posY();y+posY<0&&(y=-(y-yside),this.posY(y)),y+h+posY>this.wraph&&(y=-(y+h-this.wraph+yside),this.posY(y))}return this},pos_control:function(){var thisx=this.posX(),thisy=this.posY(),x_chk=this.limit_chk({x:thisx}),x_limit=this.get_limit({x:thisx}),y_chk=this.limit_chk({y:thisy}),y_limit=this.get_limit({y:thisy});x_chk&&y_chk||(this.set_pos({x:thisx,y:thisy}),Math.abs(thisx-x_limit)>70&&this.set_pos({x:x_limit},this.duration),Math.abs(thisy-y_limit)>70&&this.set_pos({y:y_limit},this.duration))},set_pos:function(obj,duration){obj=$.extend({},{x:0,y:0},obj);var style=supportsCssTransitions?{transition:duration?duration+"ms linear":"0ms",transform:"translate3d("+obj.x+"px, "+obj.y+"px, 0px)"}:{left:obj.x+"px",top:obj.y+"px"};this.list.css(style)},posX:function(val){if(void 0!==val){var to=this.get_limit({x:val});return"first"==val?to=0:"last"==val&&(to=this.right),this.stop_animation(),this.set_pos({x:to},this.duration),this}return this.list.position().left},posY:function(val){if(void 0!==val){var to=this.get_limit({y:val});return"first"==val?to=0:"last"==val&&(to=this.bottom),this.stop_animation(),this.set_pos({y:to},this.duration),this}return this.list.position().top},get_event_data:function(){return{obj:this,target:this.target,posX:this.posX(),posY:this.posY()}}},$.fn.touchFlow=function(settings){return this.each((function(){$.data(this,"touchFlow")||$.data(this,"touchFlow",new TouchFlow(this,settings))}))}}));
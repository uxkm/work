var Grid=function(){function e(e,i){r(e),this.__title=$("#"+e).data("title"),this.__gridView=null,this.__id=e,this.__options=i,this.__type="grid",this.__getEditCallBack,this.__userContextMenuList=[],this.__displayOptions={showInnerFocus:!1,editItemMerging:!0},i&&"tree"==i.type?"tree"==i.type&&(this.__type=i.type,n(this,i)):t(this);var o=this.__gridView,a=this.__dataProvider;o.setDataSource(a),o.onEditRowChanged=function(e,t,n,i,a,r){o.commit(!0)},o.addCellStyle("red",{foreground:"#red"},!0),o.setSelectOptions({style:"singleRow"}),o.setStateBar({mark:"text",stateTexts:{created:"C",updated:"U",deleted:"D",createAndDeleted:"X"}}),o.setEditOptions({insertable:!0,appendable:!0}),o.setStyles(mercurySkin),o.setPasteOptions({checkReadOnly:!0}),o.setDisplayOptions(this.__displayOptions)}var t=function(e){var t=new RealGridJS.LocalDataProvider,n=new RealGridJS.GridView(e.__id);e.__dataProvider=t,e.__gridView=n,n.setOptions({sortMode:"explicit"}),n.setCopyOptions({singleMode:!0})},n=function(e,t){var n=new RealGridJS.LocalTreeDataProvider,i=new RealGridJS.TreeView(e.__id),o="",a=150;t&&t.treeHeader&&(t.treeHeader&&(o=t.treeHeader),t.width&&(a=t.width));var r=[{fieldName:"icon"},{fieldName:"tree"},{fieldName:"text"},{fieldName:"value"}],l=[{name:"text",fieldName:"text",width:a,styles:{textAlignment:"near"},header:{text:o}},{name:"value",fieldName:"value",width:"150",styles:{textAlignment:"near"},header:{text:"value"},visible:!1}];i.setPanel({visible:!1}),i.setStateBar({visible:!1}),i.setCheckBar({visible:!1}),i.setEditOptions({editable:!1,updatable:!1}),i.setHeader({visible:!0}),t&&(0==t.header&&i.setHeader({visible:!1}),t.column&&(l=l.concat(t.column.getColumns()),r=r.concat(t.column.getFields()))),n.setFields(r),i.setColumns(l),i.setFooter({visible:!1}),i.setIndicator({visible:!1}),e.__dataProvider=n,e.__gridView=i},i=function(e,t){var n,i=e.__gridView,o=e.__options;if(!(t.getGroupColumns().length<1)){var a=!1,r="none";o.expander&&(a=o.expander),o.rowGroup&&(r=o.rowGroup),n={expandedAdornments:r,mergeExpander:a,mergeMode:!0},i.setRowGroup(n),i.groupBy(t.getGroupColumns())}},o=function(e,t){e.setColumns(t.getColumns())},a=function(e,t){e.setFields(t.getFields())},r=function(e){var t=$("#"+e),n=t.height();t.width("100%"),n<1&&t.height("200px")},l=function(e,t){var n=e.__dataProvider,i=n.getRowState(t).toLowerCase(),o="none";i.search("delete")>-1&&(i.indexOf("and")>-1&&(o=i.substr(0,i.indexOf("and"))+"d"),n.setRowState(t,o))},s=function(e){var t;switch(e){case"C":t="created";break;case"U":t="updated";break;case"D":t="deleted";break;case"N":t="none";break;default:t=null}return t},u=function(e,t){e.setStyles({body:{dynamicStyles:t},fixed:{dynamicStyles:t}})},d=function(e,t){for(var n=null,i=0;i<e.length;i++)for(var o=1;o<e.length;o++){if(e[o-1][t]>e[o][t])n=e[o-1],e[o-1]=e[o],e[o]=n}return e},c=function(e){var t=e.__options.column,n=e.__gridView,i=t.getDropDownChildColumns(),o=e.__getEditCallBack;n.onGetEditValue=function(e,t,a){i[t.fieldName]&&a&&n.setValue(t.itemIndex,t.fieldName+"DropDownLabel",a.text),o&&o(e,t,a)}},h=function(e,t,n,i){var o,a,r=t.getDateRangeColumns();r&&$.each(r,function(t,r){if(o=null,n.fieldName!=r.columnName)return!0;r.to?(o=r.to,a={type:"date",minDate:new Date(i)}):r.from&&(o=r.from,a={type:"date",maxDate:new Date(i)}),o&&e.setColumnProperty(o,"editor",a)})},m=function(e,t,n,i,o){var a,r,l,s,u,d,c,h=t.getDropDownColumns();h&&h[n.fieldName]&&$.each(h[n.fieldName],function(m,f){a=f.options,d=f.url,c=d.split("/"),r=e.columnByName(f.child),o||_(n,e,h,h[n.fieldName]),u=a.params,a.paramName&&(u||(u={}),u[a.paramName]=i),c[c.length-1]&&""!=c[c.length-1]||(d+=i),l=t.getData(d,u,a.callback),s=t.bindDropDown(l,a),r.values=s.values,r.labels=s.labels,r.lookupDisplay=!0,r.editor={type:"dropDown",domainOnly:!0,textReadOnly:!0},e.setColumn(r)})},_=function(e,t,n,i){$.each(i,function(i,o){if(!t.getValue(e.dataRow,o.child+"DropDownLabel")||""==t.getValue(e.dataRow,o.child+"DropDownLabel"))return!0;var a=t.columnByName(o.child);a.values=[],a.labels=[],a.lookupDisplay=!0,a.editor={type:"dropDown",domainOnly:!0,textReadOnly:!0},t.setColumn(a),t.setValue(e.dataRow,o.child+"DropDownLabel",""),t.setValue(e.dataRow,o.child,""),n[o.child]&&_(e,t,n,n[o.child])})},f=function(e,t,n){var i,o,a=e.__gridView,r=e.__options.column.getNumberColumns(),l=e.__dataProvider,s="",u=t.itemIndex,d=a.getDataRow(u);return void 0!==t.row&&(u=a.getItemIndex(t.row),d=a.getDataRow(u)),t.dataRow&&(d=t.dataRow),"tree"==e.__type&&(u=t.itemIndex),"grid"==e.__type&&(s=l.getRowState(d)),n?(i=l.getValue(d,n),(o=p(a,n,i))&&(i=o)):(i=a.getValues(u),$.each(i,function(e,t){(o=p(a,e,i[e]))&&(i[e]=o)})),$.extend(i,{dataRow:u}),$.extend(i,{gridState:s.substring(0,s.length-1)}),null==i?null:($.each(r,function(e,t){void 0!==i[t]&&isNaN(i[t])&&(i[t]=null)}),i)},p=function(e,t,n){var i;return e.getColumnProperty(t,"styles")?(i=e.getColumnProperty(t,"styles").datetimeFormat)&&n?(i=(i=i.replace("yyyy","YYYY")).replace("dd","DD"),moment(n).format(i)):void 0:null},g=function(e){var t=e.__gridView;e.__dataProvider;t.onItemChecked=function(n,i,o){l(e,t.getDataRow(i)),e.__itemCheckCallback&&e.__itemCheckCallback(e,i,o)}},w=function(e){var t=e.__gridView,n=e.__options,i=e.__userContextMenuList,o=[];n&&0==n.context||(i.length>0&&(o=o.concat(i)).push({label:"-"}),o.push({label:"ExcelExport"}),t.setContextMenu(o),y(e,t,i))},y=function(e,t,n){t.onContextMenuItemClicked=function(t,i,o){$.each(n,function(e,n){i.label==n.label&&n.callback&&n.callback(t,i,o)}),"ExcelExport"==i.label&&e.downExcel()}};return e.prototype={build:function(){var e,t,n,r,s,d,_,p,y,C,v,x,b,D,R=this.__options,V=this.__dataProvider,k=this.__gridView,S=this;"grid"==this.__type&&(a(V,R.column),o(k,R.column),i(this,R.column),$.each(R.column.getColumns(),function(e,t){if(t.editor&&"date"==t.editor.type)return!1})),function(e,t){if(t){var n=e.__gridView;n.setPanel({visible:!1}),n.setCheckBar({visible:!1}),n.setFooter({visible:!1}),1==t.panel&&n.setPanel({visible:!0}),0==t.status&&n.setStateBar({visible:!1}),1==t.check&&n.setCheckBar({visible:!0}),t.readOnly&&n.setEditOptions({editable:!1,updatable:!1}),0==t.rowNum&&n.setIndicator({visible:!1}),1==t.footer&&n.setFooter({visible:!0}),1==t.hideSelectColor&&n.setSelectOptions({style:""}),0==t.rowSelect&&n.setStyles({selection:{background:null,border:null}})}}(this,R),w(this),t=(e=this).__options.column,n=e.__gridView,t&&(n.onEditCommit=function(e,i,o,a){h(n,t,i,a),o!=a&&m(n,t,i,a)}),s=(r=this).__gridView,(d=r.__options.column)&&$.each(d.getReadOnlyColumns(),function(e,t){s.setColumnProperty(t,"readOnly",!0),s.setColumnProperty(t,"editable",!1)}),c(this),p=(_=this).__options.column,y=_.__gridView,C=p.getDropDownColumns(),y.onCurrentRowChanged=function(e,t,n){n>=0&&$.each(C,function(e,t){m(y,p,{fieldName:e,row:n},_.getValue(n,e),!0)})},x=(v=this).__gridView,(b=v.__options.column.getButtonColumns())&&(x.onImageButtonClicked=function(e,t,n,i,o){b[n.name]&&(0,b[n.name].callback)({row:t,column:n.name,data:f(v,{itemIndex:t})})}),g(this),D=this,$(".grid-button-group").each(function(){$(this).data("gridId")==D.__id&&($(this).children(".add-grid-row").click(function(){D.commit();var e=$(this).data("callback"),t=$(this).data("prev"),n=!0;t&&(n=window[t]()),n&&(D.addRow(),e&&1==n&&window[e]())}),$(this).children(".remove-grid-row").click(function(){D.commit();var e=$(this).data("callback"),t=$(this).data("prev"),n=!1;$.confirm(message.delete.confirm,common.general.ok,function(){(n=!t||window[t]())&&(D.removeRow(),e&&1==n&&window[e]())})}),$(this).children(".save-grid").click(function(){D.commit();var e=$(this).data("prev"),t=$(this).data("callback");if(t){if(0==(!e||window[e]()))return;$.confirm(message.save.confirm,common.general.ok,function(){window[t]()})}}),$(this).children(".down-excel-grid").click(function(){var e=$(this).data("prev"),t=$(this).data("callback");if(t){if(e&&!window[e]())return;D.downExcel(t)}}))}),function(e){$(".mes > aside").change(function(){e.__gridView.resetSize()});var t=$("#"+e.__id).parents(".mercury-tab").prop("id");t&&$("#li-"+t).click(function(){e.__gridView.resetSize()})}(this),k.onItemAllChecked=function(e,t){if(!t)for(var n=0;n<V.getRowCount();n++)l(S,n)};var O=[{criteria:"row mod 2 <> 0",styles:"background=#f7fbfd"}];return R&&R.hideRowColor&&1==R.hideRowColor&&(O=[]),u(k,O),this.__dynamicStyles=O,this.__dynamicCellStyles={},this},bind:function(e){var t=this.__options,n=null,i={focusVisible:!1,showEmptyMessage:!0,emptyMessage:biz.data.notfound};$.extend(i,this.__displayOptions),t&&1==t.keepFocus&&(n=this.getCurrent());var o,a,r,l,s,u,c,h,m,_,f,p,g,w,y=this.__gridView;if(!e||e.length<1?y.setDisplayOptions(i):y.setDisplayOptions({focusVisible:!0}),"grid"==this.__type)this.__dataProvider.setRows(e);else if("tree"==this.__type){if(!e)return null;var C=(s=e,u=this.__options,f=[],p="value",g="text",w="parent",u&&(u.text&&(g=u.text),u.value&&(p=u.value),u.parent&&(w=u.parent)),$.each(s,function(e,t){c=t[g],h=t[p],m=t[w],_=t,$.extend(_,{text:c,value:h}),m&&$.extend(_,{parent:m}),f.push(_)}),f),v=(o=C,a=this.__options,r={},l=[],a&&a.sort&&d(o,a.sort),$.each(o,function(e,t){r[t.value]=t}),$.each(o,function(e,t){r[t.parent]&&(r[t.parent].rows?r[t.parent].rows.push(t):$.extend(r[t.parent],{rows:[t]}))}),$.each(r,function(e,t){t.parent&&""!=t.parent.replace(/(\s*)/g,"")&&delete r[e]}),$.each(r,function(e,t){l.push(t)}),a&&a.sort&&d(l,a.sort),{rows:l});this.__dataProvider.fillJsonData(v,{rows:"rows",icon:"icon"}),this.__gridView.expandAll()}return $("#"+this.__id+"_rows").text(this.getRowCount()),n?this.setCurrent(n):this.setCurrent(0),this},load:function(e,t,n,i){var o=this;"boolean"==typeof e&&(i=e,t=null,n=null,t=null),"boolean"==typeof t&&(i=t,n=null,t=null),"function"==typeof t&&(i=n,n=t,t=null),"boolean"==typeof n&&(i=n,n=null);var a=function(e){o.bind(e),"function"==typeof n&&n(e)};return 1!=i?($.get(e,t,a),this):($.post(e,t,a),this)},select:function(e){var t=this;this.__gridView.onDataCellClicked=function(n,i){var o=f(t,i);e(o)}},click:function(e,t){var n,i=this.__gridView,o=this;t||(t=e,e=null),e&&(n=e.replace(/ /gi,"").split(",")),i.onDataCellClicked=function(a,r){var l=f(o,r);n&&n.indexOf(r.column)>-1?($.extend(r,i.getColumnProperty(r.column,"header")),t(l,r)):e||t(l)}},rowChanged:function(e){var t=this.__gridView,n=this;t.onCurrentRowChanged=function(i,o,a){if(!(a<0)){var r=f(n,{itemIndex:t.getItemIndex(a),dataRow:a});e(r,t.getItemIndex(o),t.getItemIndex(a))}}},doubleClick:function(e,t){var n,i=this.__gridView,o=this;return t||(t=e,e=null),e&&(n=e.replace(/ /gi,"").split(",")),i.onDataCellDblClicked=function(a,r){var l=f(o,r);n&&n.indexOf(r.column)>-1?($.extend(r,i.getColumnProperty(r.column,"header")),t(l,r)):e||t(l)},this},change:function(e,t){"function"==typeof e&&(t=e,e=null),this.__getEditCallBack=function(n,i,o){e&&i.column==e?t(i.dataRow,o.value):t(i.dataRow,i.column,o.value)},c(this)},commit:function(){this.__gridView.commit()},groupBy:function(e){this.__gridView.groupBy(e)},addRow:function(e){e?this.__dataProvider.addRow(e):(this.__gridView.beginAppendRow(),this.__gridView.commit(!0)),$("#"+this.__id+"_rows").text(this.getRowCount())},addRows:function(e){var t=this.__dataProvider;$.each(e,function(e,n){t.addRow(n)}),$("#"+this.__id+"_rows").text(this.getRowCount())},removeFocusRow:function(e,t){var n,i=this.getFocusData(),o=this.__dataProvider,a=this.getCurrent().itemIndex;n=!(o.getRowState(a).search("create")>-1),"function"==typeof e&&(t=e,e=null),1==e&&(n=!1),o.setOptions({softDeleting:n}),o.removeRow(a),t&&t(i)},removeRow:function(e){var t,n=this.__dataProvider,i=(this.__gridView,"create"),o=!1;e&&"U"==e?i="update":e&&"D"==e?i="delete":e&&1==e&&(o=!0);var a=0;$.each(this.__gridView.getCheckedRows(),function(e,r){r-=a,t=!(n.getRowState(r).search(i)>-1||o),n.setOptions({softDeleting:t}),n.removeRow(r),t||a++}),$("#"+this.__id+"_rows").text(this.getRowCount())},allChecked:function(e){this.__gridView.checkAll(e)},setVisible:function(e,t){var n=this.__gridView,i=n.columnByName(e);i&&n.setColumnProperty(i,"visible",t)},getCurrent:function(){return this.__gridView.getCurrent()},getCheckRowCount:function(){return this.__gridView.getCheckedRows(!0).length},getCheckData:function(){var e=[],t=this.__gridView,n=this;return $.each(t.getCheckedRows(),function(t,i){e.push(f(n,{row:i}))}),e},getRowCount:function(e){var t=this.__dataProvider,n=0;return e?(e.toUpperCase().indexOf("C")>-1&&(n+=t.getRowStateCount(RealGridJS.RowState.CREATED)),e.toUpperCase().indexOf("U")>-1&&(n+=t.getRowStateCount(RealGridJS.RowState.UPDATED)),e.toUpperCase().indexOf("D")>-1&&(n+=t.getRowStateCount(RealGridJS.RowState.DELETED)),e.toUpperCase().indexOf("N")>-1&&(n+=t.getRowStateCount(RealGridJS.RowState.NONE)),n):t.getRowCount()},getDataSet:function(e){return this.getData(null,e)},getData:function(e,t){var n;this.__gridView.commit(!0);var i=0,o=[],a=this,r=["C","U","D"];return e&&("all"==e?r.push("N"):r=e.trim().split(",")),t&&(o={}),$.each(r,function(e,r){n=function(e,t,n,i){var o,a=[],r=e.__dataProvider;e.__gridView;return $.each(r.getStateRows(t),function(r,l){if(o=f(e,{row:l}),!i&&"all"!=t)return o.gridState=t.substring(0,t.length-1),a.push(o),!0;$.each(o,function(e,t){""!==t&&(a[i+"["+n+"]."+e]=t)}),a[i+"["+n+"].gridState"]=t.substring(0,t.length-1),n++}),{data:a,idx:n}}(a,s(r),i,t),t?$.extend(o,n.data):o=o.concat(n.data),i=n.idx}),o.length<1&&(o=null),o},getValue:function(e,t){return f(this,{row:e},t)},valid:function(e){var t=!0,n=this.__dataProvider,i=["C","U"];e&&("all"==e?i.push("N"):i=e.trim().split(","));var o,a,r,l=[],u=this.__gridView;o=u,a=this.__options.column,$.each(a.getValidations(),function(e,t){if(!t)return!0;(r=o.columnByName(t.name)).validations=t.rules,o.setColumn(r)}),$.each(i,function(e,t){l=l.concat(n.getStateRows(s(t)))});var d,c,h,m=u.checkValidateCells(l);return m&&m.length>0&&(t=!1),d=u,c=this.__options.column,$.each(c.getValidations(),function(e,t){if(!t)return!0;(h=d.columnByName(t.name)).validations=null,d.setColumn(h)}),t},downExcel:function(e){var t=this.__options;t||(t={}),t.fileName||(t.fileName="",this.__title&&(t.fileName=this.__title),t.fileName+=moment(new Date).format("YYYY-MM-DD HH:mm"));var n={type:"excel",target:"local",fileName:t.fileName+".xlsx",showProgress:!0,applyDynamicStyles:!0,lookupDisplay:!0,compatibility:"2010",done:function(){e&&window[e]()}};$.extend(t,this.__options),t.title&&$.extend(n,{documentTitle:{message:t.title,visible:!0,styles:{fontSize:40,fontBold:!0,textAlignment:"center",lineAlignment:"center",background:"#08f90000"},spaceTop:1,spaceBottom:0,height:60}}),t.subTitle&&$.extend(n,{excelSubTitleOptions:{message:t.subTitle,visible:!0,styles:{textAlignment:"far",background:"#08f90000",height:60}}}),t.tail&&$.extend(n,{documentTail:{message:t.tail,visible:!0,styles:{fontSize:12,fontBold:!0,textAlignment:"center",background:"#080000f1"}}}),this.__gridView.exportGrid(n)},clean:function(){this.bind(null)},getFocusData:function(){var e,t=this.__gridView.getCurrent();if(t.itemIndex<0)return null;delete t.dataRow;try{e=f(this,t)}catch(e){}return e},setColumn:function(e){var t=this.__dataProvider,n=this.__gridView,r=this.__type,l=this.__options;l&&l.column?l.column=e:l?l.column||$.extend(l,{column:e}):l={column:e},"grid"==r&&(a(t,e),o(n,e),i(this,e))},resetCurrent:function(){this.__gridView.resetCurrent()},insertRow:function(e,t){var n=this.__dataProvider;t.constructor!=Object?$.each(t,function(t,i){n.insertRow(e,i)}):n.insertRow(e,t)},setTextColor:function(e,t,n){n||(n="red"),this.__gridView.setCellStyle(e,t,n)},setRowFix:function(e){this.setFix(e,null)},setColFix:function(e){this.setFix(null,e)},setRightColFix:function(e){this.setFix(null,null,e)},setFocusValue:function(e,t){for(var n=this.__dataProvider,i=this.__gridView,o=this.getRowCount(),a=0;a<o;a++){if(t==n.getValue(a,e)){var r={dataRow:a};return void i.setCurrent(r)}}},setFix:function(e,t,n){var i={};e&&$.extend(i,{rowCount:e}),t&&$.extend(i,{colCount:t}),n&&$.extend(i,{rightColCount:n}),this.__gridView.setFixedOptions(i)},setValues:function(e,t,n){return"object"==typeof t&&(n=t,t=null),t?this.__gridView.setValue(e,t,n):this.__gridView.setValues(e,n,!0),this},addColumnStyle:function(e,t,n){var i,o=this.__gridView,a=this.__dynamicCellStyles;(i=a[e]?a[e]:[]).push({criteria:t,styles:n}),o.setColumnProperty(e,"dynamicStyles",i),a[e]=i,this.__dynamicCellStyles=a},addColumnBackground:function(e,t,n){this.addColumnStyle(e,t,"background="+n)},addColumnColor:function(e,t,n){this.addColumnStyle(e,t,"foreground="+n)},clearRowStyle:function(){var e=[{criteria:"row mod 2 <> 0",styles:"background=#f7fbfd"}],t=this.__options;t&&t.hideRowColor&&1==t.hideRowColor&&(e=[]),this.__dynamicStyles=e,u(this.__gridView,this.__dynamicStyles)},clearColumnStyle:function(){var e=this.__gridView;$.each(this.__dynamicCellStyles,function(t,n){e.setColumnProperty(t,"dynamicStyles",[])}),this.__dynamicCellStyles={}},addRowStyle:function(e,t,n){var i="background";n&&(i=n),i=i+"="+t,this.__dynamicStyles.push({criteria:e,styles:i}),u(this.__gridView,this.__dynamicStyles)},sendCheckData:function(e,t){var n,i;$.each(this.getCheckData(),function(o,a){n=0,i=a[t],$.each(e.getData("all"),function(e,o){if(i<o[t])return!1;n++}),e.insertRow(n,a)}),this.removeRow(!0)},setEditing:function(e,t){var n={dataRow:e,fieldName:t},i=this.__gridView;i.setCurrent(n),i.showEditor()},setTitle:function(e){this.__title=e},setCurrent:function(e){"number"==typeof e&&(e={itemIndex:e}),this.__gridView.setCurrent(e)},getGridView:function(){return this.__gridView},getDataProvider:function(){return this.__dataProvider},itemChecked:function(e){var t=this;return this.__itemCheckCallback=function(n,i,o){e(f(t,{itemIndex:i}),o,t)},g(this),this},addContextMenu:function(e,t){return this.__userContextMenuList.push({label:e,callback:t}),w(this),this},convertJsonData:function(e,t){var n=[],i=0;return $.each(e,function(e,o){$.each(o,function(e,o){o&&""!=o&&(n[t+"["+i+"]."+e]=o)}),i++}),n},clearRows:function(){this.__dataProvider.clearRows()}},e}(),Column=function(){function e(){this._columns=[],this._columnsName=[],this._fields=[],this._validations=[],this._events={},this._uniqueColumns=[],this._groupColumns=[],this._readOnlyColumns=[],this._dateRangeColumns=[],this._dropDownColumns={},this._buttonColumns={},this._numberColumns=[]}var t=function(e,t,n){var i={name:e,fieldName:e,header:{text:t}};return n?(n.group&&$.extend(i,{type:"group",fieldName:null}),n.labels&&$.extend(i,{lookupDisplay:!0}),n.columns&&$.extend(i,{width:100*n.columns.length}),n.hidden&&1==n.hidden&&$.extend(i,{visible:!1}),$.extend(i,n),i):i},n=function(e,t,n){var i=new RealGridJS.DataField;return i.fieldName=e,"object"==typeof t&&(n=t,t=null),n?(n.min&&(i.min=n.min),n.max&&(i.max=n.max),n.defaultValue&&(i.defaultValue=n.defaultValue),!t||"number"!=t&&"date"!=t||(i.dataType=t,n.calc&&"number"==t&&(i.calculateExpression=n.calc)),i):i},i=function(e,t,n,i){var o,a="value ",r=[];return i?($.each(i,function(e,t){if("required"!=e&&"min"!=e&&"max"!=e)return!0;(o=new RealGridJS.EditValidation).active=!0,o.mode="always",o.level="warning","required"==e&&1==t&&(o.criteria=a+"is not empty ",o.message=""),"number"==n&&"min"==e&&(o.criteria=a+"> "+t,o.message=""),"number"==n&&"max"==e&&(o.criteria=a+"< "+t,o.message=""),r.push(o)}),{name:e,rules:r}):null},o=function(e,t,n){var i,o,a,r,l,s,u;return"object"==typeof e&&(n=e,e="text",t=null),n||(n={}),t||(t=120),$.extend(n,{width:t}),$.extend(n,(o=n,a={type:i=e,textAlignment:"near"},"number"==i&&$.extend(a,{editFormat:"#,##0.##",multipleChar:"+",textAlignment:"far"}),"dropDown"==i&&$.extend(a,{domainOnly:!0,textReadOnly:!0}),"date"==i&&$.extend(a,{datetimeFormat:o.datetimeFormat,mask:{editMask:"9999-99-99",placeHolder:"yyyy-MM-dd",includedFormat:!0}}),o&&o.max&&"number"!=i&&$.extend(a,{maxLength:o.max}),$.extend(a,o),{editor:a})),$.extend(n,(u={type:r=e,textAlignment:"near"},(l=n)&&l.format&&(s=l.format),"number"==r&&(s||(s="#,##0.##"),$.extend(u,{numberFormat:s,textAlignment:"far"})),"date"==r&&$.extend(u,{datetimeFormat:s}),$.extend(u,l),{styles:u})),n};return e.prototype={add:function(e,a,r,l){var s="text";"object"==typeof a&&(l=a,a=e),l&&l.type&&(s=l.type),l=o(s,r,l);var u=this._columnsName.indexOf(e);return u>-1?(this._validations[u]=i(e,0,s,l),this._columns[u]=t(e,a,l),this._fields[u]=n(e,s,l),this):(l.groupBy&&1==l.groupBy&&this._groupColumns.push(e),1==l.readOnly&&this._readOnlyColumns.push(e),1==l.uniq&&this._getUniqueColumns.push(e),this._columnsName.push(e),this._validations.push(i(e,0,s,l)),l.required&&delete l.required,this._columns.push(t(e,a,l)),this._fields.push(n(e,s,l)),this)},addHidden:function(e,t,n,i){return"object"==typeof t&&(i=t,t=null),"object"==typeof n&&(i=n,n=null),i||(i={}),t||(t=e),$.extend(i,{hidden:!0}),this.add(e,t,n,i),this},addGroup:function(e,n,i,o,a){if("object"==typeof o&&(a=o,o=null),a||(a={}),!i||"object"!=typeof i)throw"not support type ";return o&&$.extend(a,{displayWidth:o}),$.extend(a,{group:!0}),$.extend(a,{columns:i.getColumns()}),i.getFields()&&i.getFields().length>0&&(this._fields=this._fields.concat(i.getFields())),i.getValidations()&&i.getValidations().length>0&&(this._validations=this._validations.concat(i.getValidations())),i.getGroupColumns()&&i.getGroupColumns().length>0&&(this._groupColumns=this._groupColumns.concat(i.getGroupColumns())),i.getReadOnlyColumns()&&i.getReadOnlyColumns().length>0&&(this._readOnlyColumns=this._readOnlyColumns.concat(i.getReadOnlyColumns())),this._columns.push(t(e,n,a)),this},addNumber:function(e,t,n,i){return i||(i={}),$.extend(i,{type:"number"}),$.extend(i,{textAlignment:"far"}),this._numberColumns.push(e),this.add(e,t,n,i),this},addMultiLine:function(e,t,n,i){return i||(i={}),$.extend(i,{type:"multiline"}),this.add(e,t,n,i),this},addDropDown:function(e,t,n,i,o){var a,r,l;return"string"==typeof n&&(a=n,n=null),"number"==typeof n&&(i=n,n=null),"object"==typeof i&&(o=i,i=null),o?(o.params&&(r=o.params),o.callback&&(l=o.callback)):o={},o.parent?(this._dropDownColumns[o.parent]||(this._dropDownColumns[o.parent]=[]),this._dropDownColumns[o.parent].push({child:e,url:a,options:o}),this.addHidden(e+"DropDownLabel"),$.extend(o,{labelField:e+"DropDownLabel"})):(a&&(n=this.getData(a,r,l)),$.extend(o,this.bindDropDown(n,o))),$.extend(o,{type:"dropDown"}),this.add(e,t,i,o),this},addDatePicker:function(e,t,n,i,o){return n&&"object"==typeof n&&(o=n,n=null,i=null),"number"==typeof n&&(o=i,i=n,n=null),o||(o={}),n||(n="yyyy-MM-dd"),$.extend(o,{format:n}),$.extend(o,{type:"date"}),$.extend(o,{textAlignment:"center"}),this.add(e,t,i,o),this},addDateRange:function(e,t,n,i,o){"object"==typeof n&&(o=n,n=null,i=null),"number"==typeof n&&(o=i,i=n,n=null);var a={columnName:e};return o.from||o.to||alert("plz define form or to"),o.from&&$.extend(a,{from:o.from}),o.to&&$.extend(a,{to:o.to}),this._dateRangeColumns.push(a),this.addDatePicker(e,t,n,i,o),this},addCheck:function(e,t,n,i){var o="Y",a="N",r={type:"check",editable:!0,shape:"box",startEditOnClick:!0};return i&&(i.checked&&(o=i.checked),i.unchecked&&(a=i.unchecked)),"object"==typeof n&&(i=n,n=null),"number"==typeof t&&(n=t,t=null),$.extend(r,{trueValues:o,falseValues:a,type:"check"}),this.add(e,t,n,{renderer:r,type:"data",defaultValue:a}),this},addImageButton:function(e,t,n,i,o){var a={type:"button",button:"image",alwaysShowButton:!0,imageButtons:{width:45,height:13,images:[{name:t,up:"/images/"+i.up,hover:"/images/"+i.hover,down:"/images/"+i.down}]}};return"object"==typeof n&&(i=n,n=null),$.extend(a,i),$.extend(i,{callback:o}),this._buttonColumns[e]=i,this.add(e,t,n,a),this},addButton:function(e,t,n,i,o){var a={type:"button",button:"action",alwaysShowButton:!0};return"object"==typeof n&&(i=n,n=null),$.extend(a,i),$.extend(i,{callback:o}),this._buttonColumns[e]=i,this.add(e,t,n,a),this},getColumns:function(){return this._columns},getFields:function(){return this._fields},getValidations:function(){return this._validations},getUniqueColumns:function(){return this._uniqueColumns},getGroupColumns:function(){return this._groupColumns},getReadOnlyColumns:function(){return this._readOnlyColumns},getDateRangeColumns:function(){return this._dateRangeColumns},getDropDownColumns:function(){return this._dropDownColumns},bindDropDown:function(e,t){var n,i=[],o=[],a="code",r="descr",l="",s="";return t&&(t.valueField&&(a=t.valueField),t.textField&&(r=t.textField)),(!t||1==t.unselect||1!=t.required&&0!=t.unselect)&&(t&&t.selectHeader&&(l=t.selectHeader),t&&t.selectHeaderValue&&(s=t.selectHeaderValue),o.push(l),i.push(s)),$.each(e,function(e,t){i.push(t[a]),(n=t[r])||(n=t[a]),o.push(n)}),{values:i,labels:o}},getData:function(e,t,n){var i;return $.getSync(e,t,function(e){i=e,n&&n(e)}),i},getDropDownChildColumns:function(){var e={};return $.each(this._dropDownColumns,function(t,n){$.each(n,function(t,n){e[n.child]=n})}),e},getButtonColumns:function(){return this._buttonColumns},getNumberColumns:function(){return this._numberColumns}},e}();